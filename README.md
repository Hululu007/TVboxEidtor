# TVBox Rule Master

[![PHP Version](https://img.shields.io/badge/php-%3E=7.4-blue.svg)](https://php.net/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Status](https://img.shields.io/badge/status-active-brightgreen.svg)]()

**TVBox Rule Master** 是一个功能强大的、基于Web的TVBox规则一站式解决方案。它集成了规则管理、图形化编辑、在线调试、资源本地化和设备推送等多种功能，旨在极大地提升TVBox规则的开发和维护效率。

---

## ✨ 核心功能

* **多功能编辑界面**:
    * **主管理面板**: 宏观管理完整的配置文件（如`m.json`），对爬虫、解析、直播源等进行列表式增、删、改、查、复制和粘贴操作。
    * **图形化规则编辑器**: 针对单个爬虫规则文件（如XYQ Hiker规则）进行微观、可视化的表单编辑，告别繁琐的手动编写JSON。
    * **Ace在线代码编辑器**: 为 `.json`, `.js`, `.py` 等文件提供语法高亮、主题切换、快捷键等专业的在线代码编辑体验。

* **现代化的窗口系统**:
    * 整个UI采用强大的 `WinBox.js` 作为模态框解决方案，所有弹窗（编辑、文件浏览、设置等）均支持拖动、缩放，并在移动端自动最大化以提升体验。
    * “编辑”功能现在在当前页面以最大化弹窗形式打开，避免了新窗口带来的不便。

* **一键资源本地化**:
    * 独有的“下载”功能可自动分析远程配置文件中引用的所有外部资源（`jar`, `ext`, `spider`等）。
    * 将所有资源下载到服务器本地，并自动更新配置文件中的路径为相对路径，轻松实现配置的备份与离线化。

* **强大的在线调试工具**:
    * **实时CSS选择器测试**: 在图形化编辑器中，可针对任意规则项（如影片标题、列表数组等）进行实时抓取和测试，结果立等可见。
    * **一键自动化测试**: 自动对首页、分类、详情页等关键流程进行连续测试，快速验证规则的完整性。

* **设备直达与辅助功能**:
    * 内置“推送到TVBox”功能，可自动识别设备版本，将配置地址或搜索指令一键推送到指定的TVBox设备。
    * 提供资源健康度检查，一键检测规则中引用的网络资源是否有效。
    * 内置文件浏览器，可直接查看和加载存放在服务器 `/box` 目录下的规则文件。

## 🏛️ 技术栈

* **后端**: PHP (`>=7.4`)
    * 采用轻量级自定义MVC模式，无框架依赖，易于部署。
    * 使用 cURL 扩展进行HTTP代理请求。
* **前端**:
    * 原生 JavaScript (ES6+)，无前端框架依赖。
    * **WinBox.js**: 提供现代化、可拖拽的窗口（模态框）系统。
    * **Handlebars.js**: 用于动态渲染HTML模板。
    * **Ace Editor**: 提供专业的在线代码编辑功能。

## 📂 项目结构
```
/
├── assets/               # 存放 CSS, JS, 和第三方库 (Ace, Handlebars, WinBox)
│   ├── css/
│   └── js/
│       ├── main.js     # 主管理面板的核心逻辑
│       ├── script.js   # XYQHiker图形化编辑器的核心逻辑
│       └── utils.js    # 包含 Modal 封装类在内的通用工具函数
├── box/                # (需手动创建并设置可写权限) 用于存放用户上传、下载的规则文件和资源
├── cache/              # (需手动创建并设置可写权限) 后端代理的缓存目录
├── Controllers/        # 后端控制器
│   ├── EditController.class.php
│   └── ProxyController.class.php
├── Json/               # 存放API列表和规则模板
├── Views/              # 视图文件 (PHP模板)
│   └── Edit/
│       ├── editor.php
│       └── XYQHiker.php
├── common.php          # 后端通用函数库
├── config.php          # 项目配置文件
└── index.php           # 单一入口文件
```

## 🔧 安装与部署

### 常规部署 (适用于服务器)

1.  **环境要求**:
    * 支持 PHP 的 Web 服务器 (如 Nginx, Apache)。
    * PHP >= 7.4，并已开启 `cURL` 扩展。

2.  **部署步骤**:
    * 将所有项目文件上传到您的服务器网站根目录。
    * 在根目录手动创建 `box` 和 `cache` 两个文件夹。
    * 确保服务器对 `/box` 和 `cache` 目录有写入权限 (例如 `755` 或 `777`)。
    * （可选）在 `config.php` 文件中修改默认登录密码 `PASSWORD`。
    * （可选）如需启用URL伪静态，请将 `config.php` 中的 `REWRITE` 设置为 `true`，并为您的Web服务器配置相应的重写规则。

### ⚡️ 离线一键启动包 (Windows)

为了方便不熟悉PHP环境配置的用户，项目特别提供了一个轻量级的离线整合包。

* **开箱即用**：无需安装Apache/Nginx或PHP，所有环境已内置。
* **极致轻量**：整个包仅 **6.91MB**，绿色便携。
* **操作简单**：下载解压后，双击启动文件即可自动在浏览器中打开程序。

#### 使用方法

1.  从以下地址下载离线包：
    > **[点击这里下载]**(请在此处替换为您的下载链接)
2.  解压下载的 `.zip` 文件到任意目录（路径中尽量不要包含中文）。
3.  双击运行目录中的 `启动.bat` (或类似名称的) 文件。
4.  程序将自动在您的默认浏览器中打开，即可开始使用。

## 📖 使用指南

1.  **加载配置**：在首页输入框中粘贴一个远程JSON配置文件的URL，或通过“选择服务器文件”按钮加载本地服务器上的文件。
2.  **管理规则**：加载成功后，通过顶部的标签页切换“爬虫”、“解析”等列表。点击卡片可展开详情，点击按钮进行编辑、复制、检测等操作。
3.  **编辑文件**：在“爬虫”列表中，点击规则卡片上的“编辑”按钮，会在当前页面以最大化弹窗形式打开对应的图形化编辑器或Ace代码编辑器。
4.  **本地化配置**：点击顶部的“下载”按钮，设置一个在服务器 `/box` 目录下保存的路径和文件名，程序会自动完成所有资源的下载和路径替换。

## 📜 许可证

本项目采用 [MIT License](LICENSE) 开源。

## 🙏 作者

* **CCfork** ([Telegram](https://t.me/CCfork))
